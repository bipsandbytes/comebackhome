!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Comebackhome=t()}(this,function(){function e(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")}var t={};t.shuffle=function(e){for(var t,n,o=e.length;o;t=Math.floor(Math.random()*o),n=e[--o],e[o]=e[t],e[t]=n);return e};var n=[].slice;t.extend=function(){var e,t,o,c,a=n.call(arguments),i=a[0];for(e=1,t=a.length;e<t;e++){c=a[e];for(o in c)c.hasOwnProperty(o)&&(i[o]=c[o])}return i};var o=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return[t,e]},c=function(e,t){var n,o=[];for(n in e)e.hasOwnProperty(n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t&&o.push("_t="+Date.now()),o.join("&")};t.getJSON=function(e,t){var n={success:function(){},error:function(){}},a=window.XMLHttpRequest||ActiveXObject,i=new a("MSXML2.XMLHTTP.3.0");t&&(e+="?"+c(t)),i.open("get",e,!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?n.success.apply(n,o(i)):n.error.apply(n,o(i)))},i.send(t);var r={success:function(e){return n.success=e,r},error:function(e){return n.error=e,r}};return r},t.addEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},t.toggleClass=function(t,n){var o=" "+t.className.replace(/[\t\r\n]/g," ")+" ";if(e(t,n)){for(;o.indexOf(" "+n+" ")>=0;)o=o.replace(" "+n+" "," ");t.className=o.replace(/^\s+|\s+$/g,"")}else t.className+=" "+n},t.ready=function(e){var t=!1,n=!0,o=document.documentElement,c=document.addEventListener,a=c?"addEventListener":"attachEvent",i=c?"removeEventListener":"detachEvent",r=c?"":"on",d=function(n){"readystatechange"==n.type&&"complete"!=document.readyState||(("load"==n.type?window:document)[i](r+n.type,d,!1),!t&&(t=!0)&&e.call(window,n.type||n))},s=function(){try{o.doScroll("left")}catch(e){return void setTimeout(s,50)}d("poll")};if("complete"==document.readyState)e.call(window,"lazy");else{if(!c&&o.doScroll){try{n=!window.frameElement}catch(m){}n&&s()}document[a](r+"DOMContentLoaded",d,!1),document[a](r+"readystatechange",d,!1),window[a](r+"load",d,!1)}},t.trackUsage=function(){!function(e,t,n,o,c,a,i){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,a=t.createElement(n),i=t.getElementsByTagName(n)[0],a.async=1,a.src=o,i.parentNode.insertBefore(a,i)}(window,document,"script",("https:"==document.location.protocol?"https://":"http://")+"www.google-analytics.com/analytics.js","ga"),ga("create","UA-61554464-1","auto"),ga("send","pageview")},t.getViewport=function(){var e,t;return"undefined"!=typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.getElementsByTagName("body")[0].clientWidth,t=document.getElementsByTagName("body")[0].clientHeight),{width:e,height:t}},t.once=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}};var a={};a.body=function(e){var t='<div id="comebackhome-container"> <div id="comebackhome-header" class="comebackhome-header"> <div class="comebackhome-pulluptab">â–² Help find missing people</div> <div id="comebackhome-title" class="comebackhome-title comebackhome-title-throb">404 Person Not Found</div> </div> <div id="comebackhome-panel"> <ul id="comebackhome-results"> ',n=e;if(n)for(var o,c=-1,a=n.length-1;c<a;)o=n[c+=1],t+=" <li class=\"comebackhome-person-frame\"> <a onclick=\"ga('send', 'event', 'link', 'click', 'person')\" href=\""+o.url+'" target="_blank"> <div class="comebackhome-person-column"> <img class="comebackhome-person-picture" src="https://res.cloudinary.com/comebackhome/image/fetch/w_150,h_150,c_fill,f_auto,g_face:center,e_grayscale/'+o.thumbnail_url+'" alt='+o.display_name+' > </div> <div class="comebackhome-person-column comebackhome-person-info"> <div class="comebackhome-person-name">'+o.display_name+'</div> <div class="comebackhome-person-location">'+o.display_location+'</div> <div class="comebackhome-person-extra"> Missing since '+new Date(o.since).toLocaleDateString()+" ",o.age_now&&(t+=" <br> Age now: "+o.age_now+" "),t+=" </div> </div> </a> </li> ";return t+=' </ul> <p class="comebackhome-poweredby"> Powered by <a target="_blank" href="https://comebackhome.org/">comebackhome.org</a> </p> </div></div>'};var i=!0,r="https://comebackhome.org/api/v1/person/",d="https://s3-us-west-1.amazonaws.com/bipsandbytes-comebackhome/prefetched_data/",s="https://freegeoip.net/json/",m={itemWidth:310,itemHeight:180,timeout:2e3,heightRatio:.5},l={latitude:37.7833,longitude:-122.4167},u=2,h=function(e){if(i){var n=d+e.lat+"_"+e.lon+".json";return t.getJSON(n)}return t.getJSON(r,t.extend({},e))},p=function(e,n){var o=t.once(e),c=o.bind(this,l);t.getJSON(s).success(o).error(c),setTimeout(c,n||0)},f=function(e){return Math.max(Math.floor(e),1)},g=t.once(function(e,n){n=t.extend(m,n);var o=n.itemWidth,c=n.itemHeight,i=t.getViewport(),r=f(i.width/o),d=f(i.height*n.heightRatio/c),s=r*o,l=function(n){var o=document.createElement("div");o.innerHTML=a.body(n),e.appendChild(o);var c=document.getElementById("comebackhome-header"),i=document.getElementById("comebackhome-panel"),r=document.getElementById("comebackhome-title"),d=document.getElementById("comebackhome-results");d.style.width=s+"px",t.addEvent(c,"click",function(){ga("send","event","link","click","panel"),t.toggleClass(i,"comebackhome-show"),t.toggleClass(r,"comebackhome-title-throb")})},g=function(e){var o={format:"json",lat:Math.round(e.latitude/u)*u,lon:Math.round(e.longitude/u)*u,limit:n.limit||d*r};h(o).success(function(e){l(t.shuffle(e.objects.slice(0,o.limit)))})};p(g,n.timeout),t.trackUsage()});return g.getData=h,t.ready(function(e){"lazy"!=e&&g(document.body,{})}),g});