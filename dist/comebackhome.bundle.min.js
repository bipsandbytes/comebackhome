!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Comebackhome=t()}(this,function(){function e(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")}var t={};t.shuffle=function(e){for(var t,o,n=e.length;n;t=Math.floor(Math.random()*n),o=e[--n],e[n]=e[t],e[t]=o);return e};var o=[].slice;t.extend=function(){var e,t,n,a,c=o.call(arguments),i=c[0];for(e=1,t=c.length;e<t;e++){a=c[e];for(n in a)a.hasOwnProperty(n)&&(i[n]=a[n])}return i};var n=function(e){var t;try{t=JSON.parse(e.responseText)}catch(o){t=e.responseText}return[t,e]},a=function(e,t){var o,n=[];for(o in e)e.hasOwnProperty(o)&&n.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t&&n.push("_t="+Date.now()),n.join("&")};t.getJSON=function(e,t){var o={success:function(){},error:function(){}},c=window.XMLHttpRequest||ActiveXObject,i=new c("MSXML2.XMLHTTP.3.0");t&&(e+="?"+a(t)),i.open("get",e,!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?o.success.apply(o,n(i)):o.error.apply(o,n(i)))},i.send(t);var r={success:function(e){return o.success=e,r},error:function(e){return o.error=e,r}};return r},t.addEvent=function(e,t,o){return e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o,!1)},t.toggleClass=function(t,o){var n=" "+t.className.replace(/[\t\r\n]/g," ")+" ";if(e(t,o)){for(;n.indexOf(" "+o+" ")>=0;)n=n.replace(" "+o+" "," ");t.className=n.replace(/^\s+|\s+$/g,"")}else t.className+=" "+o},t.ready=function(e){var t=!1,o=!0,n=document.documentElement,a=document.addEventListener,c=a?"addEventListener":"attachEvent",i=a?"removeEventListener":"detachEvent",r=a?"":"on",m=function(o){"readystatechange"==o.type&&"complete"!=document.readyState||(("load"==o.type?window:document)[i](r+o.type,m,!1),!t&&(t=!0)&&e.call(window,o.type||o))},l=function(){try{n.doScroll("left")}catch(e){return void setTimeout(l,50)}m("poll")};if("complete"==document.readyState)e.call(window,"lazy");else{if(!a&&n.doScroll){try{o=!window.frameElement}catch(s){}o&&l()}document[c](r+"DOMContentLoaded",m,!1),document[c](r+"readystatechange",m,!1),window[c](r+"load",m,!1)}},t.trackUsage=function(){!function(e,t,o,n,a,c,i){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,c=t.createElement(o),i=t.getElementsByTagName(o)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script",("https:"==document.location.protocol?"https://":"http://")+"www.google-analytics.com/analytics.js","ga"),ga("create","UA-61554464-1","auto"),ga("send","pageview")},t.getViewport=function(){var e,t;return"undefined"!=typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.getElementsByTagName("body")[0].clientWidth,t=document.getElementsByTagName("body")[0].clientHeight),{width:e,height:t}},t.once=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}};var c={};c.body=function(e){var t='<div id="comebackhome-container"> <div id="comebackhome-header" class="comebackhome-header"> <div class="comebackhome-pulluptab">â–² Help find missing people</div> <div id="comebackhome-title" class="comebackhome-title comebackhome-title-throb">404 Person Not Found</div> </div> <div id="comebackhome-panel"> <ul id="comebackhome-results"> ',o=e;if(o)for(var n,a=-1,c=o.length-1;a<c;)n=o[a+=1],t+=" <li class=\"comebackhome-person-frame\"> <a onclick=\"ga('send', 'event', 'link', 'click', 'person')\" href=\""+n.url+'" target="_blank"> <div class="comebackhome-person-column"> <img class="comebackhome-person-picture" src="https://res.cloudinary.com/comebackhome/image/fetch/w_150,h_150,c_fill,f_auto,g_face:center,e_grayscale/'+n.thumbnail_url+'" alt='+n.display_name+' > </div> <div class="comebackhome-person-column comebackhome-person-info"> <div class="comebackhome-person-name">'+n.display_name+'</div> <div class="comebackhome-person-location">'+n.display_location+'</div> <div class="comebackhome-person-extra"> Missing since '+new Date(n.since).toLocaleDateString()+" ",n.age_now&&(t+=" <br> Age now: "+n.age_now+" "),t+=" </div> </div> </a> </li> ";return t+=' </ul> <p class="comebackhome-poweredby"> Powered by <a target="_blank" href="https://comebackhome.org/">comebackhome.org</a> </p> </div></div>'};var i=document.createElement("style");i.setAttribute("type","text/css");var r='.comebackhome-header .comebackhome-title,.comebackhome-person-name{font-size:16px;line-height:19.2px}.comebackhome-header .comebackhome-subheading,.comebackhome-header .comebackhome-pulluptab,.comebackhome-person-location{font-size:14px;line-height:16.8px}#comebackhome-panel .comebackhome-poweredby,.comebackhome-person-extra{font-size:12px;line-height:14.399999999999999px}#comebackhome-container{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;width:100%;max-height:100%;position:fixed;bottom:0;left:0;background-color:#fff;z-index:100000}.comebackhome-header{padding:10px;color:#eee;background-color:#428bca;cursor:pointer;}.comebackhome-header .comebackhome-subheading{float:right}.comebackhome-header .comebackhome-pulluptab{position:absolute;top:-36px;color:#eee;background-color:#428bca;right:10px;border-radius:10px 10px 0 0;padding:10px}.comebackhome-header .comebackhome-title-throb{-webkit-animation:fade 3s infinite;-moz-animation:fade 3s infinite;-o-animation:fade 3s infinite;-ms-animation:fade 3s infinite;animation:fade 3s infinite}@-moz-keyframes fade{from{opacity:1;-ms-filter:none;filter:none}50%{opacity:.2;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";filter:alpha(opacity=20)}to{opacity:1;-ms-filter:none;filter:none}}@-webkit-keyframes fade{from{opacity:1;-ms-filter:none;filter:none}50%{opacity:.2;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";filter:alpha(opacity=20)}to{opacity:1;-ms-filter:none;filter:none}}@-o-keyframes fade{from{opacity:1;-ms-filter:none;filter:none}50%{opacity:.2;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";filter:alpha(opacity=20)}to{opacity:1;-ms-filter:none;filter:none}}@keyframes fade{from{opacity:1;-ms-filter:none;filter:none}50%{opacity:.2;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";filter:alpha(opacity=20)}to{opacity:1;-ms-filter:none;filter:none}}#comebackhome-panel{display:none;padding-top:10px;}#comebackhome-panel .comebackhome-poweredby{float:right;padding-right:10px;}.comebackhome-show{display:block !important}#comebackhome-results{overflow:hidden;margin:0;padding-left:0;list-style-type:none;margin:0 auto}.comebackhome-person-frame{width:310px;height:150px;float:left;margin:10px 0}.comebackhome-person-name{margin-top:15%;color:#428bca;}.comebackhome-person-location{color:#666;}.comebackhome-person-extra{margin-top:15%;color:#999;}.comebackhome-person-picture{display:block;margin:0 auto;width:100%;max-width:150px;max-height:150px;border-radius:50%}.comebackhome-person-column{width:150px;margin-right:10px;position:relative;float:left;text-align:left;}.comebackhome-person-column:last-of-type{margin-right:0}';"textContent"in i?i.textContent=r:i.styleSheet.cssText=r;var m=document.getElementsByTagName("head")[0];m.appendChild(i);var l=!0,s="https://comebackhome.org/api/v1/person/",d="https://s3-us-west-1.amazonaws.com/bipsandbytes-comebackhome/prefetched_data/",h="https://freegeoip.net/json/",p={itemWidth:310,itemHeight:180,timeout:2e3,heightRatio:.5},f={latitude:37.7833,longitude:-122.4167},u=2,g=function(e){if(l){var o=d+e.lat+"_"+e.lon+".json";return t.getJSON(o)}return t.getJSON(s,t.extend({},e))},b=function(e,o){var n=t.once(e),a=n.bind(this,f);t.getJSON(h).success(n).error(a),setTimeout(a,o||0)},y=function(e){return Math.max(Math.floor(e),1)},k=t.once(function(e,o){o=t.extend(p,o);var n=o.itemWidth,a=o.itemHeight,i=t.getViewport(),r=y(i.width/n),m=y(i.height*o.heightRatio/a),l=r*n,s=function(o){var n=document.createElement("div");n.innerHTML=c.body(o),e.appendChild(n);var a=document.getElementById("comebackhome-header"),i=document.getElementById("comebackhome-panel"),r=document.getElementById("comebackhome-title"),m=document.getElementById("comebackhome-results");m.style.width=l+"px",t.addEvent(a,"click",function(){ga("send","event","link","click","panel"),t.toggleClass(i,"comebackhome-show"),t.toggleClass(r,"comebackhome-title-throb")})},d=function(e){var n={format:"json",lat:Math.round(e.latitude/u)*u,lon:Math.round(e.longitude/u)*u,limit:o.limit||m*r};g(n).success(function(e){s(t.shuffle(e.objects.slice(0,n.limit)))})};b(d,o.timeout),t.trackUsage()});return k.getData=g,t.ready(function(e){"lazy"!=e&&k(document.body,{})}),k});