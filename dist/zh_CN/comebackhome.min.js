!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Comebackhome=t()}(this,function(){function e(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")}var t={};t.shuffle=function(e){for(var t,n,o=e.length;o;t=Math.floor(Math.random()*o),n=e[--o],e[o]=e[t],e[t]=n);return e};var n=[].slice;t.extend=function(){var e,t,o,a,c=n.call(arguments),r=c[0];for(e=1,t=c.length;t>e;e++){a=c[e];for(o in a)a.hasOwnProperty(o)&&(r[o]=a[o])}return r};var o=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return[t,e]},a=function(e,t){var n,o=[];for(n in e)e.hasOwnProperty(n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t&&o.push("_t="+Date.now()),o.join("&")};t.getJSON=function(e,t){var n={success:function(){},error:function(){}},c=window.XMLHttpRequest||ActiveXObject,r=new c("MSXML2.XMLHTTP.3.0");t&&(e+="?"+a(t)),r.open("get",e,!0),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?n.success.apply(n,o(r)):n.error.apply(n,o(r)))},r.send(t);var i={success:function(e){return n.success=e,i},error:function(e){return n.error=e,i}};return i},t.addEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},t.toggleClass=function(t,n){var o=" "+t.className.replace(/[\t\r\n]/g," ")+" ";if(e(t,n)){for(;o.indexOf(" "+n+" ")>=0;)o=o.replace(" "+n+" "," ");t.className=o.replace(/^\s+|\s+$/g,"")}else t.className+=" "+n},t.ready=function(e){var t=!1,n=!0,o=document.documentElement,a=document.addEventListener,c=a?"addEventListener":"attachEvent",r=a?"removeEventListener":"detachEvent",i=a?"":"on",d=function(n){("readystatechange"!=n.type||"complete"==document.readyState)&&(("load"==n.type?window:document)[r](i+n.type,d,!1),!t&&(t=!0)&&e.call(window,n.type||n))},m=function(){try{o.doScroll("left")}catch(e){return void setTimeout(m,50)}d("poll")};if("complete"==document.readyState)e.call(window,"lazy");else{if(!a&&o.doScroll){try{n=!window.frameElement}catch(s){}n&&m()}document[c](i+"DOMContentLoaded",d,!1),document[c](i+"readystatechange",d,!1),window[c](i+"load",d,!1)}},t.trackUsage=function(){var e=document.createElement("script");e.type="text/javascript",e.text="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','http://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-61554464-1', 'auto'); ga('send', 'pageview');",document.getElementsByTagName("head")[0].appendChild(e)},t.getViewport=function(){var e,t;return"undefined"!=typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.getElementsByTagName("body")[0].clientWidth,t=document.getElementsByTagName("body")[0].clientHeight),{width:e,height:t}};var c="http://comebackhome.org/api/v1/person/",r="https://freegeoip.net/json/",i={latitude:37.7833,longitude:-122.4167},d=310,m=180,s=function(e){return t.getJSON(c,t.extend({},e))},l=t.getJSON.bind(t,r),u=!1,h=function(e,n){if(!u){u=!0;var o=t.getViewport(),a=function(e){return Math.max(Math.floor(e),1)},c=a(o.width/d),r=a(o.height/2/m),h=c*d,p={limit:r*c},g=document.createElement("div");g.innerHTML=f.body(),e.appendChild(g);var v=document.getElementById("comebackhome-container"),y=document.getElementById("comebackhome-panel"),b=document.getElementById("comebackhome-title"),w=document.getElementById("comebackhome-results");w.style.width=h+"px";var k=f.items,E=function(e){n=t.extend({lat:Math.round(e.latitude),lon:Math.round(e.longitude)},p,n),s(n).success(function(e){var n=t.shuffle(e.objects);w.innerHTML=k(n),t.addEvent(v,"click",function(){t.toggleClass(y,"comebackhome-show"),t.toggleClass(b,"comebackhome-title-throb")})})};l().success(E).error(E.bind(null,i)),t.trackUsage()}};h.getData=s,t.ready(function(){h(document.body,{})});var f={};return f.body=function(){var e='<div id="comebackhome-container"> <div class="comebackhome-header"> <div class="comebackhome-pulluptab">▲ 帮助寻找失踪的人</div> <div id="comebackhome-title" class="comebackhome-title comebackhome-title-throb">404 沒有找到人</div> </div> <div id="comebackhome-panel"> <ul id="comebackhome-results"></ul> <p class="comebackhome-poweredby"> 由<a target="_blank" href="http://comebackhome.org/">comebackhome.org</a>提供支持 </p> </div></div>';return e},f.items=function(e){var t="",n=e;if(n)for(var o,a=-1,c=n.length-1;c>a;)o=n[a+=1],t+='<li class="comebackhome-person-frame"> <a href="'+o.url+'" target="_blank"> <div class="comebackhome-person-column"> <img class="comebackhome-person-picture" src="http://res.cloudinary.com/comebackhome/image/fetch/w_150,h_150,c_fill,f_auto,g_face:center,e_grayscale/'+o.thumbnail_url+'" alt='+o.name+'> </div> <div class="comebackhome-person-column comebackhome-person-info"> <div class="comebackhome-person-name">'+o.display_name+'</div> <div class="comebackhome-person-location">'+o.display_location+'</div> <div class="comebackhome-person-extra"> 自'+new Date(o.since).toLocaleDateString()+"以来失踪 ",o.age_now&&(t+=" <br> 现在的年龄: "+o.age_now+"岁 "),t+=" </div> </div> </a></li>";return t},h});